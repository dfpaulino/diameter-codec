package org.example.diameter;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.SocketChannel;
import java.util.HexFormat;

public class EchoClient {
    private static SocketChannel client;
    private static EchoClient instance;

    public static EchoClient start() throws IOException {
        if (instance == null)
            instance = new EchoClient();
        instance.sendMessage();
        instance.stop();

        return instance;
    }

    public  void stop() throws IOException {
        client.close();
    }

    private EchoClient() {
        try {
            client = SocketChannel.open(new InetSocketAddress("localhost", 5858));
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public void sendMessage() {

        byte[] diamPacket = HexFormat.of().parseHex("01000304c000011001000016b60adc87f267af85000001074000002a737472696e673b3435393b3834343b494d53493939393939313233343536373831300000000001024000000c01000016000001a04000000c000000010000019f4000000c00000000000001bb4000002c000001c24000000c00000001000001bc4000001739393939393132333435363738313000000001bb40000028000001c24000000c00000000000001bc4000001231323334353637383130000000000403c0000010000028af000000050000040880000010000028af000003ec000000084000000cac11f1ff0000001e40000010696e7465726e65740000027480000038000028af0000010a4000000c000028af0000027580000010000028af000000010000027680000010000028af0000000300000400c0000010000028af00000000000003f0c0000010000028af00000000000003f1c0000010000028af00000001000003e8c0000010000028af000000000000000c8000000d000028af300000000000000680000010000028afac100a650000000780000010000028afac100a650000041a80000012000028af0001ac100a650000000001f5c0000012000028af0001ac100a650000000001ca0000002c000001cb0000000c00000000000001cc00000018040009040107050303070706000000000000001280000011000028af30303130310000000000001680000019000028af8200f110000100f11000000101000000000003f8c000002c000028af0000041080000010000028af05c81a400000041180000010000028af02cd29c00000041980000058000028af00000404c0000010000028af000000090000040a8000003c000028af0000041680000010000028af000000090000041780000010000028af000000010000041880000010000028af00000001000001084000000e737472696e670000000001284000000e737472696e670000000001164000000c609208840000011b400000116d61676d612e636f6d000000000001254000001d6d61676d612d66656467772e6d61676d612e636f6d000000");
        ByteBuffer buffer = ByteBuffer.wrap(diamPacket);
        System.out.println("message length"+diamPacket.length);
        try {
            int i = 0;
            while(i<100000) {
                Thread.sleep(1);

                client.write(buffer);
                buffer.rewind();
                i++;
            }

        } catch (IOException | InterruptedException e) {
            e.printStackTrace();
        }
    }
}
